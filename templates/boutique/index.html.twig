{% extends 'base.html.twig' %}
{% block title %}Boutique{% endblock %}

{% block body %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-start mb-3">
    <h1 class="m-0">Boutique</h1>

    <div class="d-flex flex-column align-items-end gap-2">
        {# remplace 'app_home' par le nom de ta route d'accueil si besoin #}
        <a class="btn btn-outline-secondary" href="{{ path('app_home') }}">Quitter</a>

        <a class="btn btn-success" href="{{ path('boutique_new') }}">
        Proposer un objet / service
        </a>
    </div>
  </div>


  {# Filtres #}
  <form method="get" class="card card-body mb-4">
    <div class="row g-3 align-items-end">
      <div class="col-md-4">
        <label class="form-label">Recherche</label>
        <input type="text" name="q" class="form-control" placeholder="Titre ou description…"
               value="{{ filters.q }}">
      </div>

      <div class="col-md-3">
        <label class="form-label">Catégorie</label>
        <select name="categorie" class="form-select">
          <option value="">Toutes</option>
          {% for label, value in categories %}
            <option value="{{ value }}" {{ filters.categorie == value ? 'selected' : '' }}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-2">
        <label class="form-label">Prix min</label>
        <input type="number" name="pmin" class="form-control" min="0" step="1" value="{{ filters.pmin }}">
      </div>

      <div class="col-md-2">
        <label class="form-label">Prix max</label>
        <input type="number" name="pmax" class="form-control" min="0" step="1" value="{{ filters.pmax }}">
      </div>

      <div class="col-md-3">
        <label class="form-label">Tri</label>
        <select name="order" class="form-select">
          <option value="date_desc" {{ filters.order == 'date_desc' ? 'selected' : '' }}>Plus récents</option>
          <option value="date_asc"  {{ filters.order == 'date_asc'  ? 'selected' : '' }}>Plus anciens</option>
          <option value="prix_asc"  {{ filters.order == 'prix_asc'  ? 'selected' : '' }}>Prix ↑</option>
          <option value="prix_desc" {{ filters.order == 'prix_desc' ? 'selected' : '' }}>Prix ↓</option>
        </select>
      </div>

      <div class="col-md-3 d-flex gap-2">
        <button class="btn btn-primary flex-fill" type="submit">Filtrer</button>
        <a class="btn btn-outline-secondary flex-fill" href="{{ path('boutique_index') }}">Réinitialiser</a>
      </div>
    </div>
  </form>

  {% if objets is empty %}
    <div class="alert alert-info">Aucune annonce ne correspond à vos filtres.</div>
  {% else %}
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-5 g-4">
      {% for o in objets %}
        <div class="col">
          <div class="card h-100">
            {% set img = o.imageObjet1 ? asset('uploads/boutique/' ~ o.imageObjet1) : asset('images/placeholder.png') %}
            <img src="{{ img }}" class="card-img-top" alt="{{ o.titreObjet }}">

            <div class="card-body d-flex flex-column">
              <h5 class="card-title">{{ o.titreObjet }}</h5>
              <div class="text-muted small mb-2">
                {{ o.categorie }} • {{ o.date|date('d/m/Y') }} • par {{ o.auteur }}
              </div>

              {# Résumé description (sans extension twig/string-extra) #}
              {% set desc = (o.description|default(''))|striptags %}
              <p class="card-text flex-grow-1">
                {{ desc|length > 120 ? desc|slice(0, 120) ~ '…' : desc }}
              </p>

              <div class="d-flex justify-content-between align-items-center">
                <strong>{{ o.prix }} écus</strong>
                <a class="btn btn-outline-primary btn-sm"
                   href="{{ path('boutique_show', {idObjet: o.idObjet}) }}">Voir</a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
{% endblock %}
